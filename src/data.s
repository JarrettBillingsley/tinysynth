#include "tinysynth.inc"

.global channels
.global phases
.global channel_enable
.global shadow_enable
.global shadow_noise_vol
.global shadow_noise_reload
.global shadow_mix_shift
.global shadow_channels
.global shadow_phases
.global shadow_phase_update
.global sample_ram

; 150 bytes used; 10 bytes left

; ----------------------------------------------------------------------------
; MAIN STATE (73)

.data
.type   channels, @object
.size   channels, NUM_CHANNELS * SIZEOF_CHANNEL
channels: .zero NUM_CHANNELS * SIZEOF_CHANNEL

.type	phases, @object
.size	phases, NUM_CHANNELS * SIZEOF_PHASE
phases: .zero NUM_CHANNELS * SIZEOF_PHASE

channel_enable: .byte 0

; ------------------------------------------------------------------
; SHADOW STATE (84)

shadow_enable:       .byte 0b10
shadow_noise_vol:    .byte 0
shadow_noise_reload: .byte 0
shadow_mix_shift:    .byte 3
shadow_phase_update: .byte 0

.type	shadow_channels, @object
.size	shadow_channels, NUM_CHANNELS * SIZEOF_CHANNEL
shadow_channels:
	; y vars (48)
	;     rat0  rat1  rat2  len   start vol
	.byte 0x00, 0x80, 0x00, 0x1F, 0x00, 0x0F
	.byte 0x00, 0xC0, 0x00, 0x1F, 0x00, 0x0F
	.byte 0x00, 0x20, 0x01, 0x1F, 0x00, 0x0F
	.byte 0x00, 0x40, 0x02, 0x1F, 0x00, 0x0F
	.byte 0x00, 0x40, 0x00, 0x1F, 0x20, 0x0F
	.byte 0x00, 0x60, 0x00, 0x1F, 0x20, 0x0F
	.byte 0x00, 0x90, 0x00, 0x1F, 0x20, 0x0F
	.byte 0x00, 0x20, 0x01, 0x1F, 0x20, 0x0F

.type	shadow_phases, @object
.size	shadow_phases, NUM_CHANNELS * (SIZEOF_PHASE + 1)
shadow_phases:
	; x vars (24)
	;     phs0  phs1  phs2
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00

.org SAMPLE_RAM_START
.type	sample_ram, @object
.size	sample_ram, SAMPLE_RAM_SIZE
sample_ram:
	; sine
	.byte 0x88, 0x9A, 0xBB, 0xCD, 0xDE, 0xEF, 0xFF, 0xFF
	.byte 0xFF, 0xFF, 0xFF, 0xEE, 0xDD, 0xCB, 0xBA, 0x98
	.byte 0x87, 0x65, 0x44, 0x32, 0x21, 0x11, 0x00, 0x00
	.byte 0x00, 0x00, 0x01, 0x11, 0x22, 0x34, 0x45, 0x67

	; saw
	.byte 0x00, 0x00, 0x11, 0x11, 0x22, 0x22, 0x33, 0x33
	.byte 0x44, 0x44, 0x55, 0x55, 0x66, 0x66, 0x77, 0x77
	.byte 0x88, 0x88, 0x99, 0x99, 0xAA, 0xAA, 0xBB, 0xBB
	.byte 0xCC, 0xCC, 0xDD, 0xDD, 0xEE, 0xEE, 0xFF, 0xFF

	; tri
	.byte 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77
	.byte 0x88, 0x99, 0xAA, 0xBB, 0xCC, 0xDD, 0xEE, 0xFF
	.byte 0xFF, 0xEE, 0xDD, 0xCC, 0xBB, 0xAA, 0x99, 0x88
	.byte 0x77, 0x66, 0x55, 0x44, 0x33, 0x22, 0x11, 0x00

	; square
	.byte 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
	.byte 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
	.byte 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF

	.zero 128